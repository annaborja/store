<%= form_tag memberships_path, class: 'form-styled' do %>
  <% if flash[:errors].present? -%>
    <div class="alert alert-danger" role="alert">
      <ul>
        <% flash[:errors].each do |error| -%>
          <li><%= error %></li>
        <% end -%>
      </ul>
    </div>
  <% end -%>

  <fieldset>
    <%= label_tag 'level', t('membership.purchase_form.choose_level') %>
    <%= select_tag 'level',
      options_for_select(
        @membership_levels.map do |membership_level|
          [
            t('membership.purchase_form.level_choice',
              name: t("membership.level.#{membership_level.name}.name"),
              info: t('membership.cost_per_interval',
                cost: Money.new(membership_level.usd_cost, 'USD').format,
                interval: t('membership.interval.month')
              )
            ),
            membership_level.name
          ]
        end,
        @level
      ),
      class: 'js-select-level',
      include_blank: true,
      required: true
    %>
  </fieldset>

  <fieldset>
    <%= label_tag 'level', t('membership.purchase_form.how_many_guests') %>
    <%= number_field_tag 'num_guests', 0, class: 'js-num-guests', max: 1000, min: 0 %>
  </fieldset>

  <% if @gateway_customers.length > 0 -%>
    <%= submit_tag t('membership.purchase_form.submit'),
      class: 'btn btn-lg btn-success btn-block',
      data: {
        disable_with: t('membership.purchase_form.submitting')
      }
    %>
  <% else -%>
    <script src="https://checkout.stripe.com/checkout.js"
      class="js-stripe-button stripe-button"
      data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
      data-description="A month's subscription"
      data-amount="500"
      data-locale="<%= I18n.locale %>"></script>
  <% end -%>
<% end %>
